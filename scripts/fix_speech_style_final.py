#!/usr/bin/env python3
"""
어투 일관성 수정 스크립트 (최종)
남은 개별 패턴 일괄 수정
"""

import glob
import re

# 수정 패턴 정의 (old → new)
PATTERNS = {
    # 입니다 → 이에요/예요
    '큽니다."': '커요."',
    '크십니다."': '크세요."',
    '크답니다."': '크답니다."',  # 이건 유지 (답니다는 OK)
    '바르답니다."': '발라요."',
    '찬양받으십니다."': '찬양받으세요."',
    '지팡이입니다."': '지팡이예요."',
    '자들입니다."': '자들이에요."',
    '외아들입니다."': '외아들이에요."',
    '아닙니다."': '아니에요."',
    '수치입니다."': '수치예요."',
    '살입니다."': '살이에요."',
    '말입니다."': '말이에요."',
    '말씀하십니다."': '말씀하세요."',
    '마련하십니다."': '마련하세요."',
    '기다립니다."': '기다려요."',
    '하나님이십니다."': '하나님이세요."',
    '봐서입니다."': '봐서예요."',

    # 다 → 어요/아요
    '희다."': '희어요."',
    '향해서다."': '향해서예요."',
    '하나님이시다."': '하나님이세요."',
    '하나님시다."': '하나님이세요."',
    '피웠다."': '피웠어요."',
    '피다."': '펴요."',
    '태웠다."': '태웠어요."',
    '태운다."': '태워요."',
    '키웠다."': '키웠어요."',
    '찼다."': '찼어요."',
    '쫓아냈다."': '쫓아냈어요."',
    '줍시다."': '주어요."',
    '죽는다."': '죽어요."',
    '좋다."': '좋아요."',
    '잔다."': '자요."',
    '인자하시다."': '인자하세요."',
    '영화로웠다."': '영화로웠어요."',
    '여겼다."': '여겼어요."',
    '엘리야다."': '엘리야예요."',
    '어둡다."': '어두워요."',
    '악하다."': '악해요."',
    '아신다."': '아세요."',
    '세웠다."': '세웠어요."',
    '성령이시다."': '성령이세요."',
    '섬겼다."': '섬겼어요."',
    '서신다."': '서세요."',
    '빼앗는다."': '빼앗아요."',
    '빤다."': '빨아요."',
    '붙잡혔다."': '붙잡혔어요."',
    '붙인다."': '붙여요."',
    '불러냈다."': '불러냈어요."',
    '부족하다."': '부족해요."',
    '부정하다."': '부정해요."',
    '부쉈다."': '부쉈어요."',
    '발랐다."': '발랐어요."',
    '물리신다."': '물리세요."',
    '만드신다."': '만드세요."',
    '뛰어나다."': '뛰어나요."',
    '들었단다."': '들었어요."',
    '드신다."': '드세요."',
    '도구다."': '도구예요."',
    '데려오셨단다."': '데려오셨어요."',
    '더하신다."': '더하세요."',
    '넘는다."': '넘어요."',
    '넘겼다."': '넘겼어요."',
    '내신다."': '내세요."',
    '낳는다."': '낳아요."',
    '나타냈다."': '나타냈어요."',
    '끌어모은다."': '끌어모아요."',
    '그만둡시다."': '그만두어요."',
    '그러하다."': '그래요."',
    '그랬다."': '그랬어요."',
    '귀하다."': '귀해요."',
    '굵다."': '굵어요."',
    '구별되신다."': '구별되세요."',
    '공허하다."': '공허해요."',
    '계신다."': '계세요."',
    '게라다."': '게라예요."',
    '건져냈다."': '건져냈어요."',
    '건넜다."': '건넜어요."',
    '거다."': '거예요."',
    '강하다."': '강해요."',
    '가득하다."': '가득해요."',

    # 도다 → 어요 (옛 표현)
    '주었도다."': '주었어요."',
    '없도다."': '없어요."',
    '삼켰도다."': '삼켰어요."',
    '성소로다."': '성소예요."',
    '삼켰다."': '삼켰어요."',
}

def fix_speech_style_final():
    files = glob.glob('/root/bible-korean-free/korean/*.json')

    stats = {}
    for pattern in PATTERNS:
        stats[pattern + ' → ' + PATTERNS[pattern]] = 0

    modified_files = []

    for filepath in sorted(files):
        with open(filepath, 'r', encoding='utf-8') as f:
            content = f.read()

        original_content = content

        for old_pattern, new_pattern in PATTERNS.items():
            if old_pattern == new_pattern:  # 변경 없음
                continue
            count = content.count(old_pattern)
            if count > 0:
                stats[old_pattern + ' → ' + new_pattern] += count
                content = content.replace(old_pattern, new_pattern)

        # 변경된 경우에만 저장
        if content != original_content:
            with open(filepath, 'w', encoding='utf-8') as f:
                f.write(content)
            modified_files.append(filepath.split('/')[-1])

    return stats, modified_files

if __name__ == '__main__':
    print("어투 일관성 수정 (최종) 시작...")
    print("남은 개별 패턴 일괄 수정\n")

    stats, modified_files = fix_speech_style_final()

    print("수정 통계:")
    total = 0
    for pattern, count in stats.items():
        if count > 0:
            print(f"  {pattern}: {count}건")
            total += count
    print(f"  ─────────────────")
    print(f"  총계: {total}건")

    print(f"\n수정된 파일: {len(modified_files)}개")
    for f in sorted(modified_files):
        print(f"  - {f}")

    print("\n완료!")
