#!/usr/bin/env python3
"""
어린이 성경 번역 - 어려운 한자어를 쉬운 말로 변경 (문맥 고려 버전)
대상 연령: 8-10세
"""

import json
import os
import re

korean_dir = 'korean'

# 문맥을 고려한 대체 패턴 (순서 중요!)
# (검색 패턴, 대체어)
replacement_patterns = [
    # === 1. 감정/태도 관련 ===
    # 긍휼
    ('긍휼히 여기', '불쌍히 여기'),
    ('긍휼을 베풀', '불쌍히 여기'),
    ('긍휼이 있', '불쌍히 여기심이 있'),
    ('긍휼을', '불쌍히 여기심을'),
    ('긍휼이', '불쌍히 여기심이'),
    ('긍휼', '불쌍히 여기심'),

    # 진노
    ('진노하셨', '크게 화를 내셨'),
    ('진노하시', '크게 화를 내시'),
    ('진노하', '크게 화를 내'),
    ('진노가', '크신 화가'),
    ('진노를', '크신 화를'),
    ('진노의', '크신 화의'),
    ('진노', '크신 화'),

    # 핍박
    ('핍박하', '괴롭히'),
    ('핍박을 받', '괴롭힘을 받'),
    ('핍박받', '괴롭힘을 받'),
    ('핍박을', '괴롭힘을'),
    ('핍박이', '괴롭힘이'),
    ('핍박', '괴롭힘'),

    # 징계
    ('징계하시', '벌을 주시'),
    ('징계하', '벌을 주'),
    ('징계를 받', '벌을 받'),
    ('징계를', '벌을'),
    ('징계', '벌'),

    # === 2. 능력/특성 관련 ===
    ('전능하신 하나님', '모든 것을 하실 수 있는 하나님'),
    ('전능하신', '모든 것을 하실 수 있으신'),
    ('전능한', '모든 것을 할 수 있는'),
    ('전능자', '모든 것을 하실 수 있으신 분'),

    ('교활한', '꾀가 많은'),
    ('교활하게', '꾀를 부려'),

    # === 3. 회개/변화 관련 ===
    ('회개하고', '잘못을 뉘우치고'),
    ('회개하', '잘못을 뉘우치'),
    ('회개를', '뉘우침을'),
    ('회개', '뉘우침'),

    # === 4. 장소 관련 ===
    ('광야에서', '빈 들에서'),
    ('광야로', '빈 들로'),
    ('광야를', '빈 들을'),
    ('광야의', '빈 들의'),
    ('광야에', '빈 들에'),
    ('광야', '빈 들'),

    ('황무지', '빈 땅'),

    # === 5. 상태/처지 관련 ===
    ('포로로 잡혀', '잡혀'),
    ('포로가 되', '잡혀가'),
    ('포로로', '잡혀서'),
    ('포로들', '잡혀간 사람들'),
    ('포로를', '잡혀간 사람들을'),
    ('포로', '잡혀간 사람'),

    # === 6. 성품 관련 ===
    ('완악한 마음', '고집스러운 마음'),
    ('완악하게', '고집스럽게'),
    ('완악한', '고집스러운'),
    ('완악하', '고집스럽'),

    ('패역한', '반항하는'),
    ('패역하', '반항하'),
    ('패역', '반항'),

    ('강퍅한', '완고한'),
    ('강퍅하', '완고하'),

    ('탐욕스러', '욕심이 많'),
    ('탐욕', '욕심'),

    # === 7. 깨끗함/더러움 관련 ===
    ('정결하게 하', '깨끗하게 하'),
    ('정결케 하', '깨끗하게 하'),
    ('정결하게', '깨끗하게'),
    ('정결해지', '깨끗해지'),
    ('정결한', '깨끗한'),
    ('정결하', '깨끗하'),
    ('정결', '깨끗함'),

    ('부정하게', '더럽게'),
    ('부정해지', '더러워지'),
    ('부정한', '더러운'),
    ('부정하', '더럽'),
    ('부정', '더러움'),

    ('불결하게', '더럽게'),
    ('불결한', '더러운'),

    # === 8. 우상 관련 ===
    ('우상숭배', '가짜 신 섬기기'),
    ('우상들', '가짜 신들'),
    ('우상을', '가짜 신을'),
    ('우상의', '가짜 신의'),
    ('우상', '가짜 신'),

    # === 9. 행동 관련 ===
    # 음행/간음은 성경에서 자주 나오지만 어린이에게 적합하지 않음
    # 문맥에 따라 "하나님을 배신함" 또는 생략이 나을 수 있음
    ('음행', '나쁜 짓'),
    ('간음', '나쁜 짓'),

    # 헌신/봉헌
    ('봉헌하', '바치'),
    ('봉헌', '바침'),
    ('헌신하', '드리'),
    ('헌신', '드림'),

    # === 10. 구원/멸망 관련 ===
    # 구원 - 문맥별 처리
    ('구원하시', '구해주시'),
    ('구원하', '구해주'),
    ('구원받', '구해짐을 받'),
    ('구원을 주', '구해주'),
    ('구원을', '구함을'),
    ('구원의', '구해주심의'),
    ('구원이', '구해주심이'),
    ('구원', '구해주심'),

    # 멸망
    ('멸망시키', '망하게 하'),
    ('멸망하게', '망하게'),
    ('멸망하', '망하'),
    ('멸망할', '망할'),
    ('멸망을', '망함을'),
    ('멸망', '망함'),

    ('멸하시', '없애시'),
    ('멸하', '없애'),
    ('멸할', '없앨'),

    # 구속
    ('구속하시', '구해내시'),
    ('구속하', '구해내'),
    ('구속', '구해냄'),

    # === 11. 축복/저주 관련 (조심스럽게) ===
    # 축복 - "복을 빌다" 형태로
    ('축복하시며', '복을 빌어주시며'),
    ('축복하며', '복을 빌며'),
    ('축복하시', '복을 빌어주시'),
    ('축복하', '복을 빌'),
    ('축복받', '복을 받'),
    ('축복을', '복을'),
    ('축복이', '복이'),
    ('축복', '복'),

    # 저주
    ('저주하시', '나쁘게 말씀하시'),
    ('저주하', '나쁘게 말하'),
    ('저주받', '벌을 받'),
    ('저주를', '벌을'),
    ('저주가', '벌이'),
    ('저주', '벌'),

    # === 12. 심판 관련 ===
    ('심판하시', '판단하시'),
    ('심판하', '판단하'),
    ('심판받', '판단받'),
    ('심판을', '판단을'),
    ('심판의', '판단의'),
    ('심판', '판단'),

    # === 13. 사람 유형 ===
    ('의인', '올바른 사람'),
    ('악인', '나쁜 사람'),
    ('죄인들', '죄를 지은 사람들'),
    ('죄인', '죄를 지은 사람'),
    ('성도들', '하나님을 믿는 사람들'),
    ('성도', '하나님을 믿는 사람'),
    ('이방인들', '다른 나라 사람들'),
    ('이방인', '다른 나라 사람'),
    ('유대인들', '유대 사람들'),
    ('유대인', '유대 사람'),
]

def apply_replacements(content, counts):
    """패턴 기반 대체 적용 (순서대로)"""
    for old, new in replacement_patterns:
        if old in content:
            count = content.count(old)
            content = content.replace(old, new)
            key = f'{old} → {new}'
            counts[key] = counts.get(key, 0) + count
    return content

def fix_file(filepath):
    """단일 파일 수정"""
    with open(filepath, 'r', encoding='utf-8') as f:
        content = f.read()

    original = content
    counts = {}

    content = apply_replacements(content, counts)

    if content != original:
        with open(filepath, 'w', encoding='utf-8') as f:
            f.write(content)
        return counts
    return {}

def main():
    total_counts = {}
    files_modified = []

    for filename in sorted(os.listdir(korean_dir)):
        if not filename.endswith('.json'):
            continue

        filepath = os.path.join(korean_dir, filename)
        counts = fix_file(filepath)

        if counts:
            files_modified.append(filename)
            for key, count in counts.items():
                total_counts[key] = total_counts.get(key, 0) + count

    # 결과 출력
    print(f"\n=== 어려운 단어 수정 완료 ===")
    print(f"수정된 파일: {len(files_modified)}개\n")

    print("변경 내역 (상위 30개):")
    sorted_counts = sorted(total_counts.items(), key=lambda x: x[1], reverse=True)
    total = 0
    for i, (change, count) in enumerate(sorted_counts):
        if i < 30:
            print(f"  {change}: {count}건")
        total += count

    if len(sorted_counts) > 30:
        print(f"  ... 외 {len(sorted_counts) - 30}개 패턴")

    print(f"\n총 {total}건 수정")
    return total

if __name__ == '__main__':
    main()
